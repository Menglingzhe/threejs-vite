import{C as r,S as a,P as o,W as h,A as d,R as c,E as l,O as m,G as p,a as w,L as u}from"./GLTFLoader.caf95867.js";import{r as g,o as M,d as A,e as E}from"./index.3aeb01c0.js";class b{constructor(e,t){this.container=document.querySelector(e),this.camera,this.scene,this.model,this.renderer,this.panzi,this.animateAction,this.progressFn,this.clock=new r,this.onFinish=t,this.init(),this.animate()}init(){this.initScene(),this.initCamera(),this.initRenderer(),this.addMesh(),window.addEventListener("resize",this.onWindowResize.bind(this)),window.addEventListener("mousewheel",this.onMouseWheel.bind(this))}initScene(){this.scene=new a,this.setEnvMap("000")}initCamera(){this.camera=new o(45,window.innerWidth/window.innerHeight,.25,200),this.camera.position.set(-1.8,.6,2.7)}initRenderer(){this.renderer=new h({antialias:!0}),this.renderer.setPixelRatio(window.devicePixelRatio),this.renderer.setSize(window.innerWidth,window.innerHeight),this.renderer.toneMapping=d,this.renderer.toneMappingExposure=3,this.container.appendChild(this.renderer.domElement)}setEnvMap(e){new c().setPath("./files/hdr/").load(e+".hdr",t=>{t.mapping=l,this.scene.background=t,this.scene.environment=t})}render(){var e=this.clock.getDelta();this.mixer&&this.mixer.update(e),this.renderer.render(this.scene,this.camera)}animate(){this.renderer.setAnimationLoop(this.render.bind(this))}initControl(){this.control=new m(this.camera,this.renderer.domElement)}onWindowResize(){this.camera.aspect=window.innerWidth/window.innerHeight,this.camera.updateProjectionMatrix(),this.renderer.setSize(window.innerWidth,window.innerHeight)}setModel(e){return new Promise((t,s)=>{new p().setPath("files/gltf/").load(e,i=>{this.model&&this.model.removeFromParent(),this.model=i.scene.children[0],e=="bag2.glb"&&!this.panzi&&(this.panzi=i.scene.children[5],this.scene.add(i.scene),this.camera=i.cameras[0],this.mixer=new w(i.scene.children[1]),this.animateAction=this.mixer.clipAction(i.animations[0]),this.animateAction.setDuration(20).setLoop(u),this.animateAction.clampWhenFinished=!0,this.spotlight1=i.scene.children[2].children[0],this.spotlight1.intensity=1,this.spotlight2=i.scene.children[3].children[0],this.spotlight2.intensity=1,this.spotlight3=i.scene.children[4].children[0],this.spotlight3.intensity=1),this.scene.add(i.scene),t(this.modelName+"\u6A21\u578B\u6DFB\u52A0\u6210\u529F")},i=>{this.progressFn(i)})})}onProgress(e){this.progressFn=e}async addMesh(){let e=await this.setModel("bag2.glb");this.onFinish(e)}onMouseWheel(e){let t=e.deltaY>0?1:-1;this.animateAction.setEffectiveTimeScale(t),this.animateAction.paused=!1,this.animateAction.play(),this.timeoutid&&clearTimeout(this.timeoutid),this.timeoutid=setTimeout(()=>{this.animateAction.halt(.5)},300)}}const v={class:"scene",id:"scene"},R={setup(n){const e=g({base3d:{}});return M(()=>{e.base3d=new b("#scene"),console.log("@")}),(t,s)=>(A(),E("div",v))}};export{R as default};
